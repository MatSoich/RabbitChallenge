<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax:{inlineMath:[['\$','\$'],['\\(','\\)']],processEscapes:true},CommonHTML: {matchFontHeight:false}});</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

# LSTM
- RNNの課題
  - 時間を遡れば遡るほど、勾配が消失して、長い時間の学習が困難。
    - シグモイド関数は勾配消失問題が起きやすい。
  - その解決策として、構造自体を変えてしまったのが、LSTM

# 確認テスト２３
- シグモイド関数を微分した時、入力値は0で最大値を取る。
- その値は何か。
> \\\(sigmoid(x) = \displaystyle \frac{1}{1 + e^{-x}}\\\)
> \\\(\displaystyle sigmoid(x)^\prime = (1 - sigmoid(x))sigmoid(x)\\\)
> \\\(sigmoid(0)= 0.5\\\) より \\\(sigmoid(x)^\prime = 0.25\\\)

# LSTM続き
- 勾配爆発
  - 購買消失と逆の現象である勾配爆発も起こり得る。
  - 学習率を推奨値でない値に設定するとよく発生する。

# 演習チャレンジ
![kakunin](imgs/EnshuChallange04.png)
- 正解は１。勾配のノルムを計算してそれが閾値より大きい時は勾配のノルムが閾値の範囲に入るように正規化する。そのためには、ノルムが１より大きい場合、勾配に閾値/ノルムを掛け算することで値を小さくし、閾値から超えないような処理をしている。（閾値から超える場合、それを繰り返す。）

# CEC
![kakunin](imgs/LSTM.png)
- RNNで重要な過去からの情報をLSTNで一元管理しているのが、CEC(Constant Error Carousel)
  - これまでの入力値や中間層の出力値だけをCECに持たせている。
    - RNNは学習と記憶を同じ中間層が持っていた
  - 時系列を遡らせないためには、\\\(\displaystyle \delta^{t-z-1} = \delta^{t-z} \left\lbrace Wf^{\prime} \left(u^{t-z-1}\right) \right\rbrace　=1\\\)となれば良いという発想。
    - ただ勾配が１ということは覚えた結果をそのまま返すということで学習特性がないということ。
    - そのため、CECの周囲に学習機能を持たせ、適切な情報をCECから伝播することでうまく機能するのではないか、という発送に至る。
      - 入力ゲートや出力ゲート

# 入力ゲートとと出力ゲート
- 入力ゲート
  - 入力ゲートはCECに入力情報を記憶するように指示を送る。
  - 入力ゲートは何をCECに覚えさせるのかを学習していく。
- 出力ゲート
  - 出力ゲートはCECの情報をどう使うかの指示を送る。
  - 出力ゲートはCECをどう使うかを学習する。
- 重みは入力ゲート出力ゲートそれぞれにWとUを持つ。
  -  Wは今回の入力をどれくらい判断材料として使うか。Uは前回の出力をどれくらい判断材料として使うか。
  -  WとUより求めたVをCUCに送付する。

# 忘却ゲート
- CECで過去の情報が使われなくなったタイミングで記憶を消去する機能が必要。
- CECの記憶を忘れさせるかどうかを判断するのが忘却ゲート
- CECからの出力であるCは、c(t)= i(t)a(t) + f(t)c(t-1)と計算される。
  - aが今回の入力の計算結果、iが入力ゲートからくる、今回の入力をどれくらい使うかの情報。
  - fが忘却ゲートから来る、前回の情報をどれくらい忘れさせるか。

# 確認テスト２４
- LSTMを用いて、以下の空欄に当てはまる単語を予測したいとする。
- 文中の「とても」という言葉は空欄の予測においてなくなっても影響はないと学習の中で判断されたとする。
- このような場合、どのゲートが作用するのが正しいのか。
  - 作用するのは忘却ゲート。とてもの部分を忘れさせることで学習に必要なもののみをCECに残す。
  
# 演習チャレンジ
![kakunin](imgs/EnshuChallange05.png)
- 正解はウ

# 覗き穴結合
- 入力ゲート、出力ゲート、忘却ゲートがCECの中身を見えるようにしている機構。
- CECの中身を見て、インプットの量を調整する。
- あまり効果的な仕組みでは結果としてなかった。